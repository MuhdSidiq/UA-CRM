{
  "schemaVersion": 2,
  "dockerfileLines": [
    "FROM php:8.3-fpm",
    "RUN apt-get update && apt-get install -y \\",
    "    nginx \\",
    "    git \\",
    "    curl \\",
    "    libpng-dev \\",
    "    libonig-dev \\",
    "    libxml2-dev \\",
    "    libzip-dev \\",
    "    zip \\",
    "    unzip \\",
    "    libicu-dev",
    RUN echo "error_reporting = E_ALL" >> /usr/local/etc/php/conf.d/docker-php-ext-error-reporting.ini
    RUN echo "display_errors = On" >> /usr/local/etc/php/conf.d/docker-php-ext-error-reporting.ini
    RUN echo "log_errors = On" >> /usr/local/etc/php/conf.d/docker-php-ext-error-reporting.ini
    RUN echo "error_log = /dev/stderr" >> /usr/local/etc/php/conf.d/docker-php-ext-error-reporting.ini
    "RUN docker-php-ext-install pdo_mysql mbstring exif pcntl bcmath gd zip intl",
    "RUN curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer",
    "COPY composer.json composer.lock /var/www/html/",
    "WORKDIR /var/www/html",
    "RUN php -d memory_limit=-1 /usr/local/bin/composer install --no-interaction --no-dev --optimize-autoloader --no-scripts",
    "COPY . /var/www/html/",
    "COPY docker/nginx.conf /etc/nginx/sites-available/default",
    "RUN chown -R www-data:www-data /var/www/html",
    "RUN chmod -R 775 /var/www/html/storage",
    "RUN chmod -R 775 /var/www/html/bootstrap/cache",
    "RUN touch /var/www/html/storage/logs/laravel.log",
    "RUN chmod 775 /var/www/html/storage/logs/laravel.log",

    "ENV APP_DEBUG=true",
    "ENV DISPLAY_DEBUG_BACKTRACE=true",

    RUN php artisan key:generate --force
    RUN php artisan config:clear
    "RUN php artisan migrate --force",
    "RUN php artisan storage:link",
    "RUN php artisan config:cache",
    "RUN php artisan route:cache",
    "RUN php artisan view:cache",
    "EXPOSE 80",
    "CMD [\"/bin/bash\", \"-c\", \"service nginx start && php-fpm\"]"
  ]
}
